setwd("/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/")
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
source("Main_diagonal.r")
test_draw_diagonal()
draw_diagonal(#'/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
"/home/ggj/jiaqiLi/dev/R_dev/To_Jiaqi/Tree/Total_dup_species.Cor.ann.sort.max_8_subclass_1.txt",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
source("Main_diagonal.r")
test_draw_diagonal()
source("Main_diagonal.r")
test_draw_diagonal()
#'/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
draw_diagonal("/home/ggj/jiaqiLi/dev/R_dev/To_Jiaqi/Tree/Total_dup_species.Cor.ann.sort.max_8_subclass_1.txt",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
test_draw_diagonal()
fname_vector <- c("/home/ggj/jiaqiLi/dev/R_dev/JiaQi/H_M/ensemble/AddFat2/celltype.NV_SRS_75.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/M_Z/AddAdipose/M_adult/celltype.NV_SRS_75.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/M_Z/AddAdipose/M_larvea/celltype.NV_SRS_75.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/Z_SS/celltype.NV_SRS_75-total.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/SS_C/celltype.NV_SRS_75-total.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/C_S/celltype.NV_SRS_75.out",
"/home/ggj/jiaqiLi/dev/R_dev/JiaQi/S_N/celltype.NV_SRS_75.out")
arranged_species_name_vector <- c(
"Nematostella",
"Schmidtea",
"Celegans",
"SeaSquirts",
"Zebrafish",
"Mouse",
"Human"
)
anno_info_fname = "/home/ggj/jiaqiLi/dev/R_dev/To_Jiaqi/Tree/438celltype-NEW-20190728.annotation"
delete_list = c("TNFalpha cells(H).z", "sst1.1 cells(P).z", "Apelin cells(H).z", "Apelin cells(P).z",
"Testicular cell.m", "Prostate gland cell.m", "Luteal cell.m",
"Mammary gland in lactation.m", "Corneal cells.lz", "Ciona31", "Trophoblast progenitor cell.m")
root_fname = "/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/root.txt"
total_celltype_mat <- read_celltype_mat(fname_vector[1])
for (file_name_str in fname_vector[-1]){
print(file_name_str)
tmp_celltype_mat <- read_celltype_mat(file_name_str)
total_celltype_mat <- merge_matrix(total_celltype_mat, tmp_celltype_mat)
}
if (CHECK_POINT) {
#check point
write.table(total_celltype_mat, file="Total_dup_species.Cor.txt",
sep="\t", quote=F, row.names=F)
}
annotated_total_celltype_mat <- anno_Cor_file(total_celltype_mat, anno_info_fname)
if (CHECK_POINT) {
#check point
write.table(annotated_total_celltype_mat, file="Total_dup_species.Cor.ann_subcluster.txt",
sep="\t", quote=F, row.names=F)
}
rearranged_anno_total_celltype_mat <- celltype_rearrange(annotated_total_celltype_mat, arranged_species_name_vector[1],
arrange_first=TRUE)
if (CHECK_POINT){
#check point
write.table(rearranged_anno_total_celltype_mat, file="Total_dup_species.Cor.ann_subcluster1.sort.txt",
sep="\t", row.names=FALSE, quote=F)
}
for (species_name in arranged_species_name_vector[-1]){
print(species_name)
rearranged_anno_total_celltype_mat <- celltype_rearrange(rearranged_anno_total_celltype_mat, species_name,
arrange_first=FALSE)
}
if (CHECK_POINT){
#check point
write.table(rearranged_anno_total_celltype_mat, file="Total_dup_species.Cor.ann_subcluster.sort.txt",
sep="\t", row.names=FALSE, quote=F)
}
if (!is.null(delete_list)){
rearranged_anno_total_celltype_mat <- delete_celltype(rearranged_anno_total_celltype_mat, delete_list)
}
## delete the duplicated rows
##
rearranged_anno_total_celltype_mat <- rearranged_anno_total_celltype_mat[!duplicated(rearranged_anno_total_celltype_mat[,c(1,2,3,4,5,6)]),]
write.table(rearranged_anno_total_celltype_mat, file="Total_dup_species.Cor.ann_subcluster.sort_1.filter.txt",sep="\t", row.names=FALSE, quote=F)
rearranged_celltype_mat <- rearranged_anno_total_celltype_mat
#####class_class_similarity
rearranged_celltype_mat <- as.data.frame(rearranged_celltype_mat, stringsAsFactors=FALSE)
rearranged_celltype_mat$Value <- as.numeric(rearranged_celltype_mat$Value)
##counting average_value
average_value_celltype_mat <- aggregate(rearranged_celltype_mat[,7],
by=list(rearranged_celltype_mat[,3], rearranged_celltype_mat[,6]),
FUN=mean, na.rm=TRUE)
colnames(average_value_celltype_mat) <- c("Sub_Cluster1", "Sub_Cluster2", "Value")
#####MAX_ADD
##as the blackground of class simialrity
##average_value{sub_cluster1}{sub_cluster2} > 0.8
blackground_aveVal_celltype <- average_value_celltype_mat[average_value_celltype_mat$Value>0.8, ]
##MAX average_value of {sub_cluster1}
max_aveVal_celltype <- aggregate(average_value_celltype_mat,
by=list(average_value_celltype_mat$Sub_Cluster1),
FUN=max, na.rm=TRUE, drop=FALSE)
max_aveVal_celltype <- max_aveVal_celltype[,c(2,3,4)]
#selected <- union(which(select$key %in% blackground$key),
#                  which(select$key %in% max_df$key))
selected <- NULL
for(key in blackground$key){
selected <- union(selected, which(select$key == key))
}
#use pasted cluster name as index
select <- rearranged_celltype_mat[,c('Sub_Cluster1', 'Sub_Cluster2')]
blackground <- blackground_aveVal_celltype[,c('Sub_Cluster1', 'Sub_Cluster2')]
max_df <- max_aveVal_celltype[,c('Sub_Cluster1', 'Sub_Cluster2')]
select$key <- paste(rearranged_celltype_mat$Sub_Cluster1, rearranged_celltype_mat$Sub_Cluster2, sep="_")
blackground$key <- paste(blackground_aveVal_celltype$Sub_Cluster1, blackground_aveVal_celltype$Sub_Cluster2, sep="_")
max_df$key <- paste(max_aveVal_celltype$Sub_Cluster1, max_aveVal_celltype$Sub_Cluster2, sep="_")
#selected <- union(which(select$key %in% blackground$key),
#                  which(select$key %in% max_df$key))
selected <- NULL
for(key in blackground$key){
selected <- union(selected, which(select$key == key))
}
for(key in max_df$key){
selected <- union(selected, which(max_df$key== key))
}
#max_black_celltype <- rearranged_celltype_mat[which(rearranged_celltype_mat$select==union(blackground_key, max_key)),]
#rownames(max_black_celltype)<-NULL
## total celltype anno_info of
## average_value{sub_cluster1}{sub_cluster2} > 0.8 OR MAX average_value of {sub_cluster1}
max_black_celltype <- rearranged_celltype_mat[selected,]
max_black_celltype <- aggregate(max_black_celltype,
by=list(max_black_celltype[,1]),
FUN=max, na.rm=TRUE, drop=FALSE)
max_black_celltype <- na.omit(max_black_celltype)
max_black_celltype <- max_black_celltype[,-1]
dim(max_black_celltype)
max_black_celltype <- aggregate(max_black_celltype,
by=list(max_black_celltype[,1], max_black_celltype[,4]),
FUN=max, na.rm=TRUE, drop=FALSE)
max_black_celltype <- na.omit(max_black_celltype)
max_black_celltype <- max_black_celltype[,-1]
dim(max_black_celltype)
max_black_celltype <- aggregate(max_black_celltype,
by=list(max_black_celltype[,1], max_black_celltype[,4]),
FUN=max, na.rm=TRUE, drop=FALSE)
max_black_celltype <- na.omit(max_black_celltype)
max_black_celltype <- max_black_celltype[,c(-1,-2)]
dim(max_black_celltype)
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
source("merge_celltype_pipeline.r")
test_merge_celltype_pipeline()
dev.off()
#'/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
pdf("out.pdf")
draw_diagonal("/home/ggj/jiaqiLi/dev/R_dev/To_Jiaqi/Tree/Total_dup_species.Cor.ann.sort.max_8_subclass_1.txt",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
draw_diagonal('/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
draw_diagonal('/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/output/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
#'/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
pdf("out.pdf")
draw_diagonal('/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/output/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
#'/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/Total_dup_species.Cor.ann.sort.max_8_subclass.txt',
pdf("out.pdf")
draw_diagonal('/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/output/Total_dup_species.Cor.ann.sort.max_8_subclass_1.txt',
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/438celltype-NEW-20190728.annotation",
"/home/ggj/jiaqiLi/dev/R_dev/script/evolution_tree/data/39Cluster_color.major.list")
dev.off()
